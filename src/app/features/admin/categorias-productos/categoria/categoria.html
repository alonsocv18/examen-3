<!-- Encabezado con botón de volver y nombre de categoría -->
<div class="page-section__header">
  <p-button label="Volver" [routerLink]="['/admin/categorias-productos']"></p-button>
  <span class="page-section__header-title"
    >Categoría: <span class="text-primary">{{ nombreCategoria }} </span></span
  >
</div>
<p-divider type="solid" />
<!-- Sección de subcategorías con botón de creación -->
<div class="flex items-center justify-between px-10">
  <span class="page-section__header-subtitle">Subcategorias:</span>
  <p-button
    label="Crear subcategoría"
    size="small"
    (click)="showModalSubcategoria = true"
  ></p-button>
</div>

<!-- Modal Crear Subcategoría -->
<app-modal
  [visible]="showModalSubcategoria"
  (visibleChange)="showModalSubcategoria = $event"
  header="Crear Subcategoría"
>
  <app-crear-categoria-form
    (guardar)="crearSubcategoria($event)"
    (cancelar)="showModalSubcategoria = false"
  ></app-crear-categoria-form>
</app-modal>

<!-- Estado de carga de subcategorías -->
<div *ngIf="isLoadingSubcategorias" class="px-10 py-4">
  <p>Cargando subcategorías...</p>
</div>

<!-- Grid de subcategorías con navegación -->
<div class="grid grid-cols-5 gap-4 py-4 px-10">
  <div
    *ngFor="let sub of subcategorias"
    [routerLink]="[
      '/admin/categorias-productos/categoria',
      idCategoria,
      nombreCategoria,
      'subcategorias',
      sub.category_id,
      sub.category_name
    ]"
    class="cursor-pointer"
  >
    <app-card
      [id]="sub.category_id"
      [nombre]="sub.category_name"
      [cantidad]="parseInt(sub.cantidad_productos?.toString() || '0')"
      [disableNavigation]="true"
    ></app-card>
  </div>
</div>

<!-- Mensaje cuando no hay subcategorías -->
<div *ngIf="!isLoadingSubcategorias && subcategorias.length === 0" class="px-10 py-2">
  <p class="text-gray-500">No hay subcategorías</p>
</div>
<!-- Barra de búsqueda y creación de productos -->
<div class="flex flex-row px-10 gap-2">
  <input type="text" placeholder="Buscar productos de la categoria" pInputText fluid />
  <p-button
    styleClass="h-auto w-40"
    label="Crear producto"
    (click)="showModalProducto = true"
  ></p-button>
  <app-modal
    [visible]="showModalProducto"
    (visibleChange)="showModalProducto = $event"
    header="Crear Producto"
  >
    <app-crear-producto-form
      (guardar)="crearProducto($event)"
      (cancelar)="showModalProducto = false"
    ></app-crear-producto-form>
  </app-modal>

  <app-modal
    [visible]="showModalEditar"
    (visibleChange)="showModalEditar = $event"
    header="Editar Producto"
  >
    <app-crear-producto-form
      [productoEditar]="productoSeleccionado"
      (guardar)="actualizarProducto($event)"
      (cancelar)="showModalEditar = false; productoSeleccionado = null"
    ></app-crear-producto-form>
  </app-modal>
</div>

<!-- Tabla de productos con operaciones CRUD -->
<div class="px-10">
  <!-- Estado de carga de productos -->
  <div *ngIf="isLoadingProductos" class="py-4">
    <p>Cargando productos...</p>
  </div>

  <!-- Tabla con datos y acciones de editar/eliminar -->
  <app-table
    *ngIf="!isLoadingProductos"
    [columns]="[
      { field: 'product_name', header: 'Producto' },
      { field: 'product_stock', header: 'Stock' },
      { field: 'product_price', header: 'Precio' },
      { field: 'acciones', header: 'Acciones' }
    ]"
    [data]="productos"
    [stateField]="'product_state'"
    (edit)="editarProducto($event)"
    (delete)="eliminarProducto($event)"
  >
  </app-table>
</div>
