<div class="page-section">
  <!-- Header -->
  <div class="page-section__header">
    <h1 class="page-section__header-title">Salones y mesas</h1>
  </div>

  <p-divider type="solid" />

  <!-- Main Content -->
  <div class="page-section__content">
    <!-- Lado izquierdo: Listado de salones -->
    <div class="page-section__sidebar">
      <div class="page-section__sidebar-header">
        <h2 class="page-section__sidebar-title">Listado de salones</h2>
        <p-divider type="solid" />
      </div>

      <!-- Search Bar -->
      <div class="page-section__search">
        <input pInputText type="text" pSize="large" placeholder="Buscar salón" />
        <p-button styleClass="h-12 w-12" label="+" (click)="showModal = true"></p-button>
      </div>

      <!-- Modal Crear Salón -->
      <app-modal [visible]="showModal" (visibleChange)="showModal = $event" header="Crear Salón">
        <app-crear-salon-form
          (guardar)="crearSalon($event)"
          (cancelar)="showModal = false"
        ></app-crear-salon-form>
      </app-modal>

      <!-- Salones List -->
      <div class="page-section__list">
        <!-- Mensaje de carga -->
        <div *ngIf="loadingSalones" class="page-section__loading">
          <p>Cargando salones...</p>
        </div>

        <!-- Mensaje si no hay salones -->
        <div *ngIf="!loadingSalones && salones.length === 0" class="page-section__empty">
          <p>No hay salones disponibles</p>
        </div>

        <!-- Lista de salones -->
        <div
          class="page-section__item"
          *ngFor="let salon of salones; let i = index"
          [class.page-section__item--selected]="salonSeleccionado?.lounge_id === salon.lounge_id"
          (click)="seleccionarSalon(salon)"
        >
          <div class="page-section__item-header">
            <h3 class="page-section__item-name">{{ salon.lounge_name }}</h3>
          </div>
          <div class="page-section__item-info">
            <span class="page-section__item-count">{{ salon.cantidad_mesas }} mesas</span>
            <span
              class="page-section__item-status"
              [class.page-section__item-status--active]="esActivo(salon.lounge_state)"
              [class.page-section__item-status--inactive]="!esActivo(salon.lounge_state)"
            >
              {{ esActivo(salon.lounge_state) ? 'Activo' : 'Inactivo' }}
            </span>
          </div>
          <div class="page-section__item-actions">
            <button
              class="page-section__item-button page-section__item-button--edit"
              (click)="abrirModalEditar(salon); $event.stopPropagation()"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path>
              </svg>
              Editar
            </button>

            <button
              *ngIf="esActivo(salon.lounge_state)"
              class="page-section__item-button page-section__item-button--inactive"
              (click)="cambiarEstadoSalon(salon); $event.stopPropagation()"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <path d="m4.9 4.9 14.2 14.2"></path>
              </svg>
              Inactivar
            </button>
            <button
              *ngIf="!esActivo(salon.lounge_state)"
              class="page-section__item-button page-section__item-button--active"
              (click)="cambiarEstadoSalon(salon); $event.stopPropagation()"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              Activar
            </button>
          </div>
        </div>
      </div>

      <!-- Modal Editar Salón -->
      <app-modal
        [visible]="showModalEditar"
        (visibleChange)="showModalEditar = $event"
        header="Editar Salón"
      >
        <app-crear-salon-form
          [salonEditar]="salonParaEditar"
          (guardar)="actualizarSalon($event)"
          (cancelar)="showModalEditar = false; salonParaEditar = null"
        ></app-crear-salon-form>
      </app-modal>
    </div>

    <p-divider layout="vertical" />

    <!-- Lado derecho: Mesas de cada salón -->
    <div class="page-section__main">
      <!-- Mostrar cuando NO hay salón seleccionado -->
      <div *ngIf="!salonSeleccionado" class="page-section__placeholder">
        <p>Selecciona un salón para ver sus mesas</p>
      </div>

      <!-- Mostrar cuando SÍ hay salón seleccionado -->
      <div *ngIf="salonSeleccionado">
        <div class="page-section__main-header">
          <svg
            class="page-section__main-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M3 9h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9Z"></path>
            <path d="m3 9 2.45-4.9A2 2 0 0 1 7.24 3h9.52a2 2 0 0 1 1.8 1.1L21 9"></path>
            <path d="M12 3v6"></path>
          </svg>
          <h2 class="page-section__main-title">
            Mesas del salón {{ salonSeleccionado.lounge_name }}
          </h2>
        </div>
        <p-divider type="solid" />

        <!-- Mensaje de carga de mesas -->
        <div *ngIf="loadingMesas" class="page-section__loading">
          <p>Cargando mesas...</p>
        </div>

        <!-- Tabla de mesas -->
        <div *ngIf="!loadingMesas && mesas.length > 0">
          <!-- Table Header -->
          <div class="page-section__table-header">
            <div class="page-section__table-col page-section__table-col--mesa">Mesa</div>
            <div class="page-section__table-col page-section__table-col--acciones">Acción</div>
          </div>

          <p-divider type="solid" />

          <!-- Table Rows -->
          <div class="page-section__table-body">
            <div class="page-section__table-row" *ngFor="let mesa of mesas">
              <!-- Nombre de mesa: editable si está en modo edición -->
              <div class="page-section__table-cell">
                <input
                  *ngIf="mesaEditando === mesa.tablee_id"
                  type="text"
                  [(ngModel)]="nombreEditando"
                  class="page-section__table-input"
                  pInputText
                />
                <span *ngIf="mesaEditando !== mesa.tablee_id">{{ mesa.tablee_name }}</span>
              </div>

              <!-- Acciones: Editar o Guardar/Cancelar -->
              <div class="page-section__table-cell page-section__table-cell--actions">
                <!-- Modo normal: botón Editar -->
                <button
                  *ngIf="mesaEditando !== mesa.tablee_id"
                  class="page-section__table-button"
                  (click)="editarMesa(mesa)"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path>
                  </svg>
                </button>

                <!-- Modo edición: botones Guardar y Cancelar -->
                <div
                  *ngIf="mesaEditando === mesa.tablee_id"
                  class="page-section__table-actions-group"
                >
                  <button
                    class="page-section__table-button page-section__table-button--save"
                    (click)="guardarMesa(mesa)"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                  </button>
                  <button
                    class="page-section__table-button page-section__table-button--cancel"
                    (click)="cancelarEdicion()"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <line x1="18" y1="6" x2="6" y2="18"></line>
                      <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Mensaje si no hay mesas -->
        <div *ngIf="!loadingMesas && mesas.length === 0" class="page-section__empty">
          <span>No hay mesas </span>
        </div>
      </div>
    </div>
  </div>
</div>
